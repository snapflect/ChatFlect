<ion-content [fullscreen]="true" class="login-content">
  <div class="login-container">
    <div class="glass-card login-card ion-padding">
      <div class="ion-text-center">
        <h1 class="gradient-text title-large">SnapFlect</h1>
        <p class="subtitle">Secure. Vibrant. Fast.</p>
      </div>

      <ion-segment [(ngModel)]="mode" (ionChange)="segmentChanged($event)" class="ion-margin-bottom">
        <ion-segment-button value="email">
          <ion-icon name="mail"></ion-icon>
        </ion-segment-button>
        <ion-segment-button value="qr">
          <ion-icon name="qr-code"></ion-icon>
        </ion-segment-button>
      </ion-segment>

      <!-- EMAIL MODE -->
      <div *ngIf="mode === 'email'">
        <div *ngIf="!otpSent" class="input-group">
          <ion-item lines="none" class="custom-input">
            <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
            <ion-input type="email" [(ngModel)]="email" placeholder="Email Address"></ion-input>
          </ion-item>

          <ion-button expand="block" shape="round" class="vibrant-btn" (click)="sendOtp()" [disabled]="!email">
            Send OTP to Email <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
          </ion-button>

          <div class="divider ion-margin-vertical">
            <span>OR</span>
          </div>

          <ion-button expand="block" shape="round" fill="outline" class="google-btn" (click)="signInWithGoogle()">
            <ion-icon name="logo-google" slot="start"></ion-icon>
            Sign in with Google
          </ion-button>
        </div>

        <div *ngIf="otpSent" class="input-group">
          <ion-item lines="none" class="custom-input">
            <ion-icon name="key-outline" slot="start" color="secondary"></ion-icon>
            <ion-input type="text" [(ngModel)]="otp" placeholder="Enter OTP"></ion-input>
          </ion-item>

          <ion-button expand="block" shape="round" class="vibrant-btn" (click)="verifyOtp()" [disabled]="!otp">
            Verify & Login
          </ion-button>

          <!-- Resend OTP Section -->
          <div class="resend-section ion-text-center ion-margin-top">
            <ion-button fill="clear" size="small" (click)="resendOtp()"
              [disabled]="resendCooldown > 0 || resendAttempts >= maxResendAttempts">
              <ion-icon name="refresh-outline" slot="start"></ion-icon>
              <span *ngIf="resendCooldown > 0">Resend in {{ resendCooldown }}s</span>
              <span *ngIf="resendCooldown === 0 && resendAttempts < maxResendAttempts">Resend OTP</span>
              <span *ngIf="resendAttempts >= maxResendAttempts">Max attempts reached</span>
            </ion-button>
            <p class="hint-text small" *ngIf="resendAttempts > 0 && resendAttempts < maxResendAttempts">
              {{ maxResendAttempts - resendAttempts }} resend(s) remaining
            </p>
          </div>
        </div>
      </div>

      <!-- QR MODE -->
      <div *ngIf="mode === 'qr'" class="ion-text-center">
        <p class="hint-text ion-margin-bottom">Scan this code with your Mobile App</p>

        <div class="qr-container">
          <canvas #qrCanvas width="256" height="256"></canvas>
        </div>

        <p class="hint-text small">Settings > Link a Device</p>
      </div>

    </div>
  </div>
</ion-content>