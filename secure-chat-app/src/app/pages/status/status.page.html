<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title class="gradient-text">Status</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-top">
  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" pullingText="Pull to refresh"
      refreshingSpinner="crescent" refreshingText="Syncing...">
    </ion-refresher-content>
  </ion-refresher>
  <!-- My Status -->
  <ion-item lines="none" class="bg-transparent status-item" (click)="myStatus ? viewStatus(myStatus, true) : null">
    <div slot="start" class="avatar-wrapper">
      <div [class.ring-container]="myStatus" [class.ring-active]="myStatus">
        <ion-avatar>
          <img [secureSrc]="getFirstMediaUrl(myStatus) || myProfilePic" />
        </ion-avatar>
      </div>

      <!-- Add Icon only if no status -->
      <div class="add-icon" *ngIf="!myStatus">
        <ion-icon name="add-circle"></ion-icon>
      </div>

      <input type="file" (change)="uploadStatus($event)" class="slat-input" *ngIf="!myStatus"
        accept="image/*,video/*,audio/*" />
    </div>
    <ion-label>
      <h2>My Status</h2>
      <p *ngIf="!myStatus">Tap to add to my status</p>
      <p *ngIf="myStatus">{{ myStatus.updates.length }} active update{{ myStatus.updates.length > 1 ? 's' : '' }}</p>

      <div class="view-count-badge" *ngIf="myStatus && myStatus.view_count && myStatus.view_count > 0"
        (click)="showViewers($event, myStatus)">
        <ion-icon name="eye"></ion-icon> {{ myStatus.view_count }}
      </div>
    </ion-label>
  </ion-item>

  <!-- Recent Updates Section -->
  <div *ngIf="recentUpdates.length > 0">
    <h5 class="section-title">Recent updates</h5>
    <ion-list class="bg-transparent">
      <ion-item *ngFor="let s of recentUpdates" (click)="viewStatus(s)" lines="none" class="status-item">
        <div slot="start" class="ring-container" [style.background]="getRingStyle(s)">
          <div class="inner-ring-bg">
            <ion-avatar class="status-ring">
              <img [secureSrc]="s.avatar" />
            </ion-avatar>
          </div>
        </div>
        <ion-label>
          <h2>{{ s.name }}</h2>
          <p>{{ getLastStatusTime(s) | date:'shortTime' }}</p>
        </ion-label>
        <ion-button fill="clear" slot="end" (click)="showStatusOptions($event, s)">
          <ion-icon name="ellipsis-vertical" color="medium"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </div>

  <!-- Viewed Updates Section -->
  <div *ngIf="viewedUpdates.length > 0">
    <h5 class="section-title">Viewed updates</h5>
    <ion-list class="bg-transparent">
      <ion-item *ngFor="let s of viewedUpdates" (click)="viewStatus(s)" lines="none" class="status-item viewed">
        <div slot="start" class="ring-container" [style.background]="getRingStyle(s)">
          <div class="inner-ring-bg">
            <ion-avatar class="status-ring">
              <img [secureSrc]="s.avatar" />
            </ion-avatar>
          </div>
        </div>
        <ion-label>
          <h2>{{ s.name }}</h2>
          <p>{{ getLastStatusTime(s) | date:'shortTime' }}</p>
        </ion-label>
        <ion-button fill="clear" slot="end" (click)="showStatusOptions($event, s)">
          <ion-icon name="ellipsis-vertical" color="medium"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </div>

  <!-- Muted Updates Section -->
  <div *ngIf="mutedUpdates.length > 0">
    <h5 class="section-title">Muted updates</h5>
    <ion-list class="bg-transparent">
      <ion-item *ngFor="let s of mutedUpdates" (click)="viewStatus(s)" lines="none" class="status-item muted">
        <div slot="start" class="ring-container ring-muted">
          <ion-avatar class="status-ring">
            <img [secureSrc]="s.avatar" />
          </ion-avatar>
        </div>
        <ion-label>
          <h2>{{ s.name }}</h2>
          <p>{{ getLastStatusTime(s) | date:'shortTime' }}</p>
        </ion-label>
        <ion-button fill="clear" slot="end" (click)="showStatusOptions($event, s)">
          <ion-icon name="ellipsis-vertical" color="medium"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </div>

  <!-- Empty State -->
  <div *ngIf="recentUpdates.length === 0 && viewedUpdates.length === 0 && mutedUpdates.length === 0"
    class="empty-state">
    <ion-icon name="albums-outline"></ion-icon>
    <p>No status updates to show</p>
  </div>

  <!-- FABs for WhatsApp-like UI -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="fab-padding">
    <!-- Text Status (Pencil) -->
    <ion-fab-button color="light" size="small" routerLink="/status-creator" class="mini-fab">
      <ion-icon name="pencil"></ion-icon>
    </ion-fab-button>

    <!-- Camera Status -->
    <ion-fab-button color="secondary">
      <ion-icon name="camera"></ion-icon>
      <input type="file" (change)="uploadStatus($event)" class="fab-input" accept="image/*,video/*,audio/*" />
    </ion-fab-button>
  </ion-fab>
</ion-content>