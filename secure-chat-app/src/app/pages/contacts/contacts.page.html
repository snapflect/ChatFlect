<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/chats" color="medium"></ion-back-button>
    </ion-buttons>
    <ion-title class="gradient-text">Contacts</ion-title>
    <ion-buttons slot="end">
      <!-- Hidden because of Refresher, but kept for accessibility -->
      <ion-button (click)="loadContacts()" class="icon-btn">
        <ion-icon name="sync" color="secondary"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar (ionInput)="onSearchChange($event)" placeholder="Search contacts..." animated="true"
      showCancelButton="focus"></ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="loadContacts($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="ion-padding-top">
    <!-- Actions -->
    <ion-list lines="none" class="bg-transparent actions-list">
      <ion-item button (click)="addContact()" class="contact-item">
        <ion-avatar slot="start" class="contact-avatar add-avatar">
          <ion-icon name="person-add" color="light"></ion-icon>
        </ion-avatar>
        <ion-label>
          <h2 class="contact-name">New Contact</h2>
        </ion-label>
      </ion-item>

      <ion-item button (click)="inviteFriend()" class="contact-item">
        <ion-avatar slot="start" class="contact-avatar invite-avatar">
          <ion-icon name="share-social" color="light"></ion-icon>
        </ion-avatar>
        <ion-label>
          <h2 class="contact-name">Invite Friends</h2>
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Empty State -->
    <div *ngIf="groupedContacts.length === 0" class="empty-state ion-text-center ion-padding">
      <p class="text-muted">No contacts found.</p>
    </div>

    <!-- Grouped Contacts -->
    <ion-item-group *ngFor="let group of groupedContacts">
      <ion-item-divider sticky class="group-header">
        <ion-label>{{ group.letter }}</ion-label>
      </ion-item-divider>

      <ion-item *ngFor="let c of group.contacts" button (click)="startChat(c)" class="contact-item">
        <ion-avatar slot="start" class="contact-avatar">
          <img [secureSrc]="c.photo_url" />
        </ion-avatar>
        <ion-label>
          <h2 class="contact-name">{{ c.displayName }}</h2>
          <p class="contact-number">{{ c.short_note || c.phone_number }}</p>
        </ion-label>
      </ion-item>
    </ion-item-group>
  </div>
</ion-content>

<style>
  .add-avatar,
  .invite-avatar {
    background: var(--ion-color-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .invite-avatar {
    background: var(--ion-color-tertiary);
  }

  .group-header {
    --background: transparent;
    --color: var(--ion-color-medium);
    font-weight: 600;
    font-size: 0.9rem;
    margin-top: 10px;
  }

  .actions-list {
    margin-bottom: 0px;
  }
</style>