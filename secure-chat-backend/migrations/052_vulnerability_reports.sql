-- 052_vulnerability_reports.sql
-- Epic 57: Vulnerability Reporting
-- Stores reports from researchers securely.

CREATE TABLE IF NOT EXISTS `vulnerability_reports` (
    `report_id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `title` VARCHAR(255) NOT NULL,
    `reporter_email` VARCHAR(255) DEFAULT NULL,
    `severity` ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL') NOT NULL,
    `affected_component` VARCHAR(100) NOT NULL,
    `status` ENUM('NEW', 'TRIAGED', 'ACCEPTED', 'REJECTED', 'FIXED', 'DISCLOSED') DEFAULT 'NEW',
    `content_hash` CHAR(64) NOT NULL, -- SHA256(Title + Description) for De-Duplication
    `payload_json` JSON NOT NULL, -- Encrypted details or raw structure
    `staff_notes` TEXT DEFAULT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY `idx_hash` (`content_hash`),
    INDEX `idx_status` (`status`),

    INDEX `idx_created` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
