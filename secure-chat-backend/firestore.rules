rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isSignedIn() {
      return request.auth != null;
    }
    // ðŸ”’ Default deny
    match /{document=**} {
      allow read, write: if false;
    }
    // âœ… Chats & Messages
    match /chats/{chatId} {
      allow read, write: if isSignedIn();
      match /messages/{msgId} {
        allow read, write: if isSignedIn();
      }
      match /typing/{userId} {
        allow read, write: if isSignedIn();
      }
    }
    // âœ… Users (profile, presence, sync, blocked, etc.)
    match /users/{userId} {
      allow read, write: if isSignedIn();
      match /blocked/{targetId} {
        allow read, write: if isSignedIn();
      }
      match /sync_requests/{reqId} {
        allow read, write: if isSignedIn();
      }
    }
    // âœ… Signaling (Calls)
    match /calls/{callId} {
      allow read, write: if isSignedIn();
    }
  }
}
